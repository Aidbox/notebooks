{"name":"JWT Auth","cells":[{"id":"6682cec8-89d9-42b3-abfd-26490ada9df9","type":"markdown","value":"You can use <http://jwtbuilder.jamiekurtz.com/> to generate JWT token for this guide","folded":{"code":true,"result":false},"result":"<p>You can use <a href=\"http://jwtbuilder.jamiekurtz.com/\">http://jwtbuilder.jamiekurtz.com/</a> to generate JWT token for this guide</p>"},{"id":"37d7463f-4aef-4d3a-8ed7-363b0f8327e0","type":"markdown","value":"First of all we have to register `TokenIntrospector` in Aidbox","folded":{"code":true,"result":false},"result":"<p>First of all we have to register <code>TokenIntrospector</code> in Aidbox</p>"},{"id":"3658e9f7-efa4-4737-be03-08abd265bc0e","type":"rest","value":"PUT /TokenIntrospector/service\ncontent-type: text/yaml\naccept: text/yaml\n\nid: service\ntype: jwt\njwt:\n  secret: qwertyuiopasdfghjklzxcvbnm123456\n  iss: Online JWT Builder\n","folded":{"result":false},"result":{"body":"jwt: {iss: Online JWT Builder, secret: qwertyuiopasdfghjklzxcvbnm123456}\ntype: jwt\nid: service\nresourceType: TokenIntrospector\nmeta: {lastUpdated: '2021-08-17T13:14:46.458366Z', createdAt: '2021-08-17T13:03:32.188878Z', versionId: '854'}\n","status":200,"headers":{"etag":"854","x-duration":9,"content-type":"text/yaml","x-request-id":"ed563a17-494e-4f8e-8d63-39bf9216ddea","cache-control":"no-cache","last-modified":"Tue, 17 Aug 2021 13:14:46 GMT"}}},{"id":"87cf4c33-cd58-4eed-8728-2121dc4757e9","type":"markdown","value":"Now we need to create `AccessPolicy` to trust the tokens from this issuer","folded":{"code":true,"result":false},"result":"<p>Now we need to create <code>AccessPolicy</code> to trust the tokens from this issuer</p>"},{"id":"adb2658a-b5dc-4e78-8236-99ef1a4654bc","type":"rest","value":"PUT AccessPolicy/service\ncontent-type: text/yaml\naccept: text/yaml\n\nengine: json-schema\nschema:\n  properties:\n    jwt:\n      required:\n        - iss\n      properties:\n        iss:\n          constant: Online JWT Builder\n  required:\n    - jwt","folded":{"result":false},"result":{"body":"engine: json-schema\nschema:\n  required: [jwt]\n  properties:\n    jwt:\n      required: [iss]\n      properties:\n        iss: {constant: Online JWT Builder}\nid: service\nresourceType: AccessPolicy\nmeta: {lastUpdated: '2021-08-17T13:14:26.875291Z', createdAt: '2021-08-17T12:25:14.675367Z', versionId: '853'}\n","status":200,"headers":{"etag":"853","x-duration":7,"content-type":"text/yaml","x-request-id":"2c1c2a09-6c09-4ac1-aca1-0cc5457aa906","cache-control":"no-cache","last-modified":"Tue, 17 Aug 2021 13:14:26 GMT"}}},{"id":"6f36e6d0-30ff-4349-a0e6-a1e28a956cd1","type":"markdown","value":"We will use the token\n```\neyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJPbmxpbmUgSldUIEJ1aWxkZXIiLCJpYXQiOjE2MjkyMDU5NTEsImV4cCI6MTY2MDc0MTk1MSwiYXVkIjoid3d3LmV4YW1wbGUuY29tIiwic3ViIjoianJvY2tldEBleGFtcGxlLmNvbSIsIkdpdmVuTmFtZSI6IkpvaG5ueSIsIlN1cm5hbWUiOiJSb2NrZXQiLCJFbWFpbCI6Impyb2NrZXRAZXhhbXBsZS5jb20iLCJSb2xlIjpbIk1hbmFnZXIiLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.aaln4IAFd9qZSR1tWuCD9SIynRdDFizBvYbMRiDvMKs\n```\nYou can see its fields here: [jwt.io](https://jwt.io/#debugger-io?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJPbmxpbmUgSldUIEJ1aWxkZXIiLCJpYXQiOjE2MjkyMDU5NTEsImV4cCI6MTY2MDc0MTk1MSwiYXVkIjoid3d3LmV4YW1wbGUuY29tIiwic3ViIjoianJvY2tldEBleGFtcGxlLmNvbSIsIkdpdmVuTmFtZSI6IkpvaG5ueSIsIlN1cm5hbWUiOiJSb2NrZXQiLCJFbWFpbCI6Impyb2NrZXRAZXhhbXBsZS5jb20iLCJSb2xlIjpbIk1hbmFnZXIiLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.aaln4IAFd9qZSR1tWuCD9SIynRdDFizBvYbMRiDvMKs)","folded":{"code":true,"result":false},"result":"<p>We will use the token</p><pre><code>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJPbmxpbmUgSldUIEJ1aWxkZXIiLCJpYXQiOjE2MjkyMDU5NTEsImV4cCI6MTY2MDc0MTk1MSwiYXVkIjoid3d3LmV4YW1wbGUuY29tIiwic3ViIjoianJvY2tldEBleGFtcGxlLmNvbSIsIkdpdmVuTmFtZSI6IkpvaG5ueSIsIlN1cm5hbWUiOiJSb2NrZXQiLCJFbWFpbCI6Impyb2NrZXRAZXhhbXBsZS5jb20iLCJSb2xlIjpbIk1hbmFnZXIiLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.aaln4IAFd9qZSR1tWuCD9SIynRdDFizBvYbMRiDvMKs\n</code></pre><p>You can see its fields here: <a href='https://jwt.io/#debugger-io?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJPbmxpbmUgSldUIEJ1aWxkZXIiLCJpYXQiOjE2MjkyMDU5NTEsImV4cCI6MTY2MDc0MTk1MSwiYXVkIjoid3d3LmV4YW1wbGUuY29tIiwic3ViIjoianJvY2tldEBleGFtcGxlLmNvbSIsIkdpdmVuTmFtZSI6IkpvaG5ueSIsIlN1cm5hbWUiOiJSb2NrZXQiLCJFbWFpbCI6Impyb2NrZXRAZXhhbXBsZS5jb20iLCJSb2xlIjpbIk1hbmFnZXIiLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.aaln4IAFd9qZSR1tWuCD9SIynRdDFizBvYbMRiDvMKs'>jwt.io</a></p>"},{"id":"20ca2b68-13c0-4a4c-81d9-49ddec3d7490","type":"markdown","value":"Now using the token you can access resources","folded":{"code":true,"result":false},"result":"<p>Now using the token you can access resources</p>"},{"id":"f68877a3-58ec-488d-bd7e-2f27c60eb55a","type":"rest","value":"GET /Patient\nauthorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJPbmxpbmUgSldUIEJ1aWxkZXIiLCJpYXQiOjE2MjkyMDU5NTEsImV4cCI6MTY2MDc0MTk1MSwiYXVkIjoid3d3LmV4YW1wbGUuY29tIiwic3ViIjoianJvY2tldEBleGFtcGxlLmNvbSIsIkdpdmVuTmFtZSI6IkpvaG5ueSIsIlN1cm5hbWUiOiJSb2NrZXQiLCJFbWFpbCI6Impyb2NrZXRAZXhhbXBsZS5jb20iLCJSb2xlIjpbIk1hbmFnZXIiLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.aaln4IAFd9qZSR1tWuCD9SIynRdDFizBvYbMRiDvMKs","folded":{"result":false},"result":{"body":"{\"query-time\":2,\"meta\":{\"versionId\":\"854\"},\"type\":\"searchset\",\"resourceType\":\"Bundle\",\"total\":9,\"link\":[{\"relation\":\"first\",\"url\":\"/Patient?page=1\"},{\"relation\":\"self\",\"url\":\"/Patient?page=1\"}],\"query-timeout\":60000,\"entry\":[{\"resource\":{\"name\":[{\"family\":\"John\"}],\"id\":\"pt-2\",\"resourceType\":\"Patient\",\"meta\":{\"lastUpdated\":\"2021-08-03T11:16:43.948207Z\",\"createdAt\":\"2021-08-03T11:16:43.948207Z\",\"versionId\":\"322\"}},\"fullUrl\":\"http://localhost:8765/Patient/pt-2\",\"link\":[{\"relation\":\"self\",\"url\":\"http://localhost:8765/Patient/pt-2\"}]},{\"resource\":{\"name\":[{\"given\":[\"Jane2\"]}],\"id\":\"pt-1\",\"resourceType\":\"Patient\",\"meta\":{\"lastUpdated\":\"2021-08-02T10:22:33.373604Z\",\"createdAt\":\"2021-08-02T10:22:33.373604Z\",\"versionId\":\"241\"}},\"fullUrl\":\"http://localhost:8765/Patient/pt-1\",\"link\":[{\"relation\":\"self\",\"url\":\"http://localhost:8765/Patient/pt-1\"}]},{\"resource\":{\"id\":\"45fa51db-1846-44a5-b087-7c70dab0b9ec\",\"resourceType\":\"Patient\",\"meta\":{\"lastUpdated\":\"2021-08-05T13:58:24.210981Z\",\"createdAt\":\"2021-08-05T13:58:24.210981Z\",\"versionId\":\"400\"}},\"fullUrl\":\"http://localhost:8765/Patient/45fa51db-1846-44a5-b087-7c70dab0b9ec\",\"link\":[{\"relation\":\"self\",\"url\":\"http://localhost:8765/Patient/45fa51db-1846-44a5-b087-7c70dab0b9ec\"}]},{\"resource\":{\"id\":\"351a7851-3d27-4235-85c9-e394c1eb65b5\",\"resourceType\":\"Patient\",\"meta\":{\"lastUpdated\":\"2021-08-05T14:01:12.302393Z\",\"createdAt\":\"2021-08-05T14:01:12.302393Z\",\"versionId\":\"407\"}},\"fullUrl\":\"http://localhost:8765/Patient/351a7851-3d27-4235-85c9-e394c1eb65b5\",\"link\":[{\"relation\":\"self\",\"url\":\"http://localhost:8765/Patient/351a7851-3d27-4235-85c9-e394c1eb65b5\"}]},{\"resource\":{\"id\":\"a513fa8c-a99e-4384-8009-0be646208b82\",\"resourceType\":\"Patient\",\"meta\":{\"lastUpdated\":\"2021-08-05T14:12:33.543328Z\",\"createdAt\":\"2021-08-05T14:12:33.543328Z\",\"versionId\":\"425\"}},\"fullUrl\":\"http://localhost:8765/Patient/a513fa8c-a99e-4384-8009-0be646208b82\",\"link\":[{\"relation\":\"self\",\"url\":\"http://localhost:8765/Patient/a513fa8c-a99e-4384-8009-0be646208b82\"}]},{\"resource\":{\"id\":\"609adea4-fa19-49ee-be09-76728c395ef9\",\"resourceType\":\"Patient\",\"meta\":{\"lastUpdated\":\"2021-08-05T14:36:29.704095Z\",\"createdAt\":\"2021-08-05T14:36:29.704095Z\",\"versionId\":\"446\"}},\"fullUrl\":\"http://localhost:8765/Patient/609adea4-fa19-49ee-be09-76728c395ef9\",\"link\":[{\"relation\":\"self\",\"url\":\"http://localhost:8765/Patient/609adea4-fa19-49ee-be09-76728c395ef9\"}]},{\"resource\":{\"id\":\"53eaa7e6-a92c-4e19-96a2-ebaab1c0fc5e\",\"resourceType\":\"Patient\",\"meta\":{\"lastUpdated\":\"2021-08-05T14:36:33.925324Z\",\"createdAt\":\"2021-08-05T14:36:33.925324Z\",\"versionId\":\"448\"}},\"fullUrl\":\"http://localhost:8765/Patient/53eaa7e6-a92c-4e19-96a2-ebaab1c0fc5e\",\"link\":[{\"relation\":\"self\",\"url\":\"http://localhost:8765/Patient/53eaa7e6-a92c-4e19-96a2-ebaab1c0fc5e\"}]},{\"resource\":{\"id\":\"9d134068-162c-453c-9f40-fe5cfa495c35\",\"resourceType\":\"Patient\",\"meta\":{\"lastUpdated\":\"2021-08-05T14:37:30.648297Z\",\"createdAt\":\"2021-08-05T14:37:30.648297Z\",\"versionId\":\"452\"}},\"fullUrl\":\"http://localhost:8765/Patient/9d134068-162c-453c-9f40-fe5cfa495c35\",\"link\":[{\"relation\":\"self\",\"url\":\"http://localhost:8765/Patient/9d134068-162c-453c-9f40-fe5cfa495c35\"}]},{\"resource\":{\"id\":\"pt-3\",\"resourceType\":\"Patient\",\"meta\":{\"lastUpdated\":\"2021-08-12T07:45:08.409591Z\",\"createdAt\":\"2021-08-12T07:45:08.409591Z\",\"versionId\":\"541\"}},\"fullUrl\":\"http://localhost:8765/Patient/pt-3\",\"link\":[{\"relation\":\"self\",\"url\":\"http://localhost:8765/Patient/pt-3\"}]}],\"query-sql\":[\"SELECT \\\"patient\\\".* FROM \\\"patient\\\" LIMIT ? OFFSET ? \",100,0]}","status":200,"headers":{"etag":"854","x-duration":6,"content-type":"application/json","x-request-id":"14f5d858-41a3-4733-bf60-457558afd22f"}}}],"description":"Make Aidbox trust external JWT token","id":"16445a01-496f-411a-b43f-9f3ac92b9dec","resourceType":"Notebook","meta":{"lastUpdated":"2021-08-17T13:14:55.876977Z","createdAt":"2021-08-17T13:14:55.876977Z","versionId":"855"},"tags":["auth"]}
